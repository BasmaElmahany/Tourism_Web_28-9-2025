<div class="attraction-details-container" *ngIf="attraction" [class.rtl]="i18n.isRTL()" [class.ltr]="!i18n.isRTL()">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-background">
      <img [src]="currentImage" [alt]="i18n.pick((attraction ).name)" class="hero-image" />
      <div class="hero-overlay"></div>
    </div>

    <div class="hero-content">
      <div class="container">
        <div class="breadcrumb">
          <a routerLink="/home">{{ i18n.translate('home') }}</a>
          <span class="material-icons">chevron_right</span>
          <a routerLink="/attractions">{{ i18n.translate('attractions') }}</a>
          <span class="material-icons">chevron_right</span>
          <span>{{ i18n.pick((attraction ).name) }}</span>
        </div>

        <div class="hero-info">
          <h1 class="attraction-title">
            {{ i18n.pick((attraction ).name) }}
          </h1>

          <div class="attraction-meta">
            <div class="rating-info">
              <div class="rating">
                <span class="material-icons">star</span>
                <span class="rating-value">
                  {{ i18n.formatNumber(attraction.rating) }}
                </span>
              </div>
              <span class="review-count">
                {{ i18n.formatNumber(attraction.reviewCount) }} {{ i18n.translate('totalReviews') }}
              </span>
            </div>
            <div class="category-badge">
              {{ i18n.pick((attraction ).category) }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Image Gallery Navigation -->
    <div class="gallery-nav" *ngIf="(attraction.imageGallery?.length ?? 0) > 1">
      <button class="gallery-btn prev" (click)="previousImage()" [disabled]="currentImageIndex === 0">
        <span class="material-icons">chevron_left</span>
      </button>
      <button class="gallery-btn next" (click)="nextImage()"
        [disabled]="currentImageIndex === (attraction.imageGallery?.length ?? 0) - 1">
        <span class="material-icons">chevron_right</span>
      </button>
    </div>

    <div class="gallery-indicators" *ngIf="(attraction.imageGallery?.length ?? 0) > 1">
      <button *ngFor="let image of attraction.imageGallery; let i = index" class="indicator"
        [class.active]="i === currentImageIndex" (click)="goToImage(i)"></button>
    </div>
  </section>

  <!-- Main Content -->
  <section class="main-content">
    <div class="container">
      <div class="content-grid">
        <!-- Left Column - Details -->
        <div class="details-column">
          <div class="content-section">
            <h2>{{ i18n.translate('aboutAttraction') }}</h2>
            <p class="description">
              {{ i18n.pick((attraction ).description) }}
            </p>

            <div class="historical-info" *ngIf="attraction.historicalPeriod || attraction.significance">
              <div class="info-item" *ngIf="attraction.historicalPeriod">
                <h4>{{ i18n.translate('historicalPeriod') }}</h4>
                <p>{{ i18n.pick((attraction ).historicalPeriod) }}</p>
              </div>
              <div class="info-item" *ngIf="attraction.significance">
                <h4>{{ i18n.translate('historicalSignificance') }}</h4>
                <p>{{ i18n.pick((attraction ).significance) }}</p>
              </div>
            </div>
          </div>

          <div class="content-section" *ngIf="(attraction.features?.length ?? 0) > 0">
            <h2>{{ i18n.translate('featuresAmenities') }}</h2>
            <div class="features-grid">
              <div class="feature-item" *ngFor="let feature of pickedFeatures(attraction)">
                <span class="material-icons">check_circle</span>
                <span>{{ feature }}</span>
              </div>
            </div>
          </div>

          <div class="content-section" *ngIf="(attraction.imageGallery?.length ?? 0) > 1">
            <h2>{{ i18n.translate('photoGallery') }}</h2>
            <div class="thumbnail-gallery">
              <div class="thumbnail" *ngFor="let image of attraction.imageGallery; let i = index"
                [class.active]="i === currentImageIndex" (click)="goToImage(i)">
                <img [src]="image" [alt]="i18n.pick((attraction ).name) + ' - ' + (i18n.formatNumber(i + 1))"
                  loading="lazy" />
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Info Card -->
        <div class="info-column">
          <div class="info-card">
            <h3>{{ i18n.translate('visitInformation') }}</h3>

            <div class="info-item">
              <div class="info-label">
                <span class="material-icons">schedule</span>
                {{ i18n.translate('openingHours') }}
              </div>
              <div class="info-value">
                {{ i18n.pick((attraction ).openingHours) }}
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <span class="material-icons">local_offer</span>
                {{ i18n.translate('ticketPrice') }}
              </div>
              <div class="info-value">
                {{ i18n.pick((attraction ).ticketPrice) }}
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <span class="material-icons">place</span>
                {{ i18n.translate('location') }}
              </div>
              <div class="info-value">
                {{ attraction.latitude.toFixed(4) }}, {{ attraction.longitude.toFixed(4) }}
              </div>
            </div>

            <div class="action-buttons">
              <a class="btn btn-primary full-width" [href]="getDirectionsUrl()" target="_blank" rel="noopener">
                <span class="material-icons">directions</span>
                {{ i18n.translate('getDirections') }}
              </a>
              <button class="btn btn-secondary full-width" (click)="addToFavorites()">
                <span class="material-icons">favorite_border</span>
                {{ i18n.translate('saveToFavorites') }}
              </button>
              <!-- If bookingUrl is the literal string 'null' we treat it as free and show a button that reveals "free" -->
              <ng-container *ngIf="attraction?.bookingUrl === 'null'; else hasLink">
                <button class="btn btn-accent full-width" (click)="handleBookClick($event)" type="button" [attr.aria-label]="i18n.translate('Book_A_Ticket')">
                  <span class="material-icons">book_online</span>
                  <span *ngIf="!showFreeLabel">{{ i18n.translate('Book_A_Ticket') }}</span>
                  <span *ngIf="showFreeLabel">{{ i18n.translate('free') }}</span>
                </button>
              </ng-container>
              <ng-template #hasLink>
                <a class="btn btn-accent full-width" [href]="attraction?.bookingUrl || '#'" target="_blank" rel="noopener" [attr.aria-label]="i18n.translate('Book_A_Ticket')">
                  <span class="material-icons">book_online</span>
                  {{ i18n.translate('Book_A_Ticket') }}
                </a>
              </ng-template>
            </div>

          </div>

          <div class="stats-card">
            <h3>{{ i18n.translate('quickStats') }}</h3>
            <div class="stat-item">
              <span class="stat-value">{{ i18n.formatNumber(attraction.rating) }}/5</span>
              <span class="stat-label">{{ i18n.translate('averageRating') }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ i18n.formatNumber(attraction.reviewCount) }}</span>
              <span class="stat-label">{{ i18n.translate('totalReviews') }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ getVisitorEstimate() }}</span>
              <span class="stat-label">{{ i18n.translate('annualVisitors') }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Related Attractions -->
  <section class="related-section" *ngIf="relatedAttractions.length > 0">
    <div class="container">
      <h2 class="section-title">{{ i18n.translate('youMightAlsoLike') }}</h2>

      <div class="related-grid">
        <div class="related-card" *ngFor="let related of relatedAttractions">
          <div class="related-image">
            <img [src]="related.imageUrl" [alt]="i18n.pick((related ).name)" loading="lazy" />
          </div>

          <div class="related-content">
            <h4>{{ i18n.pick((related ).name) }}</h4>
            <p>{{ (i18n.pick((related ).description) | slice:0:80) }}...</p>

            <div class="related-meta">
              <div class="rating">
                <span class="material-icons">star</span>
                <span>{{ i18n.formatNumber(related.rating) }}</span>
              </div>
              <span class="price">{{ i18n.pick((related ).ticketPrice) }}</span>
            </div>

            <a [routerLink]="['/attractions', related.id]" class="btn btn-primary btn-sm">
              {{ i18n.translate('viewDetails') }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="!attraction && !error">
  <div class="spinner"></div>
  <p>{{ i18n.translate('loading') }}</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error">
  <div class="error-icon">
    <span class="material-icons">error_outline</span>
  </div>
  <h2>{{ i18n.translate('noResults') }}</h2>
  <p>{{ i18n.translate('attractionsSubtitle') }}</p>
  <a routerLink="/attractions" class="btn btn-primary">
    <span class="material-icons">arrow_back</span>
    {{ i18n.translate('attractions') }}
  </a>
</div>